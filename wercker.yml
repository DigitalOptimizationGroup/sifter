box: octohost/go-1.5.1
build:
  steps:
    # Build the project
    - script:
        name: go build
        code: |
          make deps
          make build
  after-steps:
    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL

deploy:
  steps:
    - script:
        name: package build
        code: |
          sudo apt-get install -y git make unzip ruby1.9.1 ruby1.9.1-dev libssl-dev
          sudo gem install fpm-cookery package_cloud --no-ri --no-rdoc
          cd build
          sudo fpm-cook install-deps
          sudo fpm-cook
          PACKAGECLOUD=$(eval echo "\$PACKAGECLOUD_TOKEN") && echo -e "$PACKAGECLOUD" > ~/.packagecloud && chmod 600 ~/.packagecloud
          DEB_FILE=$(find . -name '*.deb') && package_cloud push darron/octohost/ubuntu/trusty $DEB_FILE
  after-steps:
    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL
